<?php

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Integrated by BKLV-Robo [RBOX-3]
 * Version: 3.0.2
 * Sysmtem URL: http://bklv.ru/robo/
 * User: webmaster.rentabox@bklv.ru
 * Date: 23.05.2017
 * Time: 13:02
 * Tech support:
 *  - url: http://bklv.ru/tech_support/
 *  - email: rbox.support.tech@bklv.ru
 *  - phone: +7(495)220-17-27
 * ---------------------------------------------------------------------------------------------------------------------
 */

#=======================================================================================================================
$path = $_SERVER['DOCUMENT_ROOT'] . '/.bklv';
/** @noinspection PhpIncludeInspection */
include($path);
#=======================================================================================================================

/** Class Rbox */
class Rbox
{

    #===================================================================================================================
    # 1. PROCEDURE PARAMS
    #-------------------------------------------------------------------------------------------------------------------
    # 1.1. notify errors - modal/portal
    #-------------------------------------------------------------------------------------------------------------------
    static $errTechOpers = array('sendmail');
    #-------------------------------------------------------------------------------------------------------------------
    # 1.2. layout options - togglers (FIXER)
    #-------------------------------------------------------------------------------------------------------------------
    static $optPostHeaderClosed = FALSE;
    static $rolesNULL = array(NULL, '');
....................
    #-------------------------------------------------------------------------------------------------------------------
    # 3.1. template options
    #-------------------------------------------------------------------------------------------------------------------
    const TEMPLATE_USER_AUTHORIZED = 'auth';
    #===================================================================================================================

    #===================================================================================================================
    /**
     * Main function for the RboxLK Handler
     * @param App $app
     * @return array
     */
    public function getLayoutPrefs(App &$app)
    {
        $prefs = array();
        ..........................
        return $prefs;
    }
    #===================================================================================================================

    #===================================================================================================================
    /**
     * operRegisterAA
     * @param $app App
     * @param $ch FormChecker
     * @return FormChecker
     */
    public function operRegisterAA(App &$app, FormChecker $ch)
    {
        #---------------------------------------------------------------------------------------------------------------
        /** 1. fix Form errors and return */
        #---------------------------------------------------------------------------------------------------------------
        $e = $ch->errors;
        if ($e) {
            $k = implode(', ', array_keys($e));
            $v = implode(', ', $e);
            $n = $k . ' :: ' . $v;
            Logger::Fix($app, __METHOD__, '{{ma_checker}}', '{{ma_checker_form}}', '{{fixFormInitErrors}}', $n);
            return $ch;
        }
        #---------------------------------------------------------------------------------------------------------------
        /** 2. init common used vars */
        #---------------------------------------------------------------------------------------------------------------
        ........................
        #---------------------------------------------------------------------------------------------------------------
        /** 5. отобразить ошибку если статус существует (данные введены) и он не в списке допустимых недопустимый !!! */
        $sts = $ch->status;
        foreach ($statuses_available as $k => $v) {
            if (!array_key_exists($k, $sts) || $sts[$k] == $v) {
                if (isset($ch->errors[$k])) {
                    unset ($ch->errors[$k]);
                }
            }
        }
        #---------------------------------------------------------------------------------------------------------------
        if ($ch->errors) {
            return $ch;
        }
        if (Proc::operRegisterAA($app, $ch) == INI::NO) {
            $ch->errors[$app->d['err']['form_key']] = $err_form;
        }
        return $ch;
    }
    #===================================================================================================================
.............................
}