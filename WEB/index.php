<?php

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Integrated by BKLV-Robo [RBOX-3]
 * Version: 3.0.2
 * Sysmtem URL: http://bklv.ru/robo/
 * User: webmaster.rentabox@bklv.ru
 * Date: 23.05.2017
 * Time: 13:02
 * Tech support:
 *  - url: http://bklv.ru/tech_support/
 *  - email: rbox.support.tech@bklv.ru
 *  - phone: +7(495)220-17-27
 * ---------------------------------------------------------------------------------------------------------------------
 */

/** Basic "Start Application" filePart */

#=======================================================================================================================
/** @var $bklv string Site secret key [код исполнения скрипта] */
$bklv = 'kljlkjlkj';
$bklv_robo = 'ljlkjlkjlkjlkjk';
$cms = $bklv_robo . '/,m,mn,mn,mn';
#-----------------------------------------------------------------------------------------------------------------------
$i = $_SERVER['DOCUMENT_ROOT'] . '/.bklv';
if (file_exists($i)) {
    /** @noinspection PhpIncludeInspection */
    include_once($i);
}
#-----------------------------------------------------------------------------------------------------------------------
/** @var $bklv string Site secret key [код исполнения скрипта] */
$i = $cms . '/php_classes/INI.bklv';
if (file_exists($i)) {
    /** @noinspection PhpIncludeInspection */
    include_once($i);
}
#=======================================================================================================================

#=======================================================================================================================
# 1. MAKE ENVIRONMENT [НАСТРАИВАЕМ ОКРУЖЕНИЕ]
#=======================================================================================================================
/** 1.1. Show all PHP Errors [временно подключаем ошибки для начальной фазы] */
# INI::showAllErr();
#-----------------------------------------------------------------------------------------------------------------------
/** 1.2. A point of time for the Start [начальная точка отсчета работы скрипта] */
INI::$appTimeStart = microtime(TRUE);
.........................
#=======================================================================================================================

#=======================================================================================================================
# 2. CHECK WWW && LOAD CONFIG [ЗАГРУЖАЕМ КОНФИГИ]
#=======================================================================================================================
/** 2.1. Redirect to root host [перенаправляем на домен без www] */
if (substr(INI::$siteHost, 0, 4) == 'www.') {
    header("Location: http://" . substr(INI::$siteHost, 4) . '/');
    exit;
}
#-----------------------------------------------------------------------------------------------------------------------
/** 2.2. Generate $cfg params [выгружаем конфигурацию в переменную $cfg] */
INI::$cfg = array_merge(INI::loadCfg($cms . '/' . INI::DIR_CMS_CFG_ROOT . '/' . INI::FILE_CFG_ROOT),
    INI::loadCfg($cms . '/' . INI::DIR_CMS_CFG_HOST . '/' . INI::$siteHost . INI::X));
........................
#=======================================================================================================================
..................
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
if (isset(INI::$cfg['site_lang']) && INI::$cfg['site_lang']) {
    CFG::$siteLang = INI::$cfg['site_lang'];
}
..................

#=======================================================================================================================
# 6. SETTINGS [УСТАНОВКИ]
#=======================================================================================================================
/** 6.1. Locality settings [установка локальности текущего домена] */
if (isset(INI::$cfg['set_locality']) && in_array(INI::$cfg['set_locality'], INI::LIST_SET_LOCALITIES)) {
    CFG::$setLocality = INI::$cfg['set_locality'];
}
#-----------------------------------------------------------------------------------------------------------------------
/** 6.2. Modality status [статус модальности текущего домена] */
if (isset(INI::$cfg['set_modality']) && in_array(INI::$cfg['set_modality'], INI::LIST_SET_MODALITIES)) {
    CFG::$setModality = INI::$cfg['set_modality'];
}
#=======================================================================================================================
...............................
#=======================================================================================================================
# 8. SITE EXECUTE [ИСПОЛНЯЕМ КОД]
#=======================================================================================================================
/** 8.1. Check-out Clean Code [проверка чистый код] */
INI::chCleanCode();
#-----------------------------------------------------------------------------------------------------------------------
/** 8.2. Hide all PHP Errors [отключаем ошибки для рабочей фазы] */
if (CFG::$setLocality != 'LOCAL' || CFG::$setModality != 'PORTAL') {
    INI::hideAllErr();
}
#-----------------------------------------------------------------------------------------------------------------------
..............................
#=======================================================================================================================

#=======================================================================================================================
/** 9. Initialize new App [инициализация приложения] */
new App();
#=======================================================================================================================